pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	px=0
	pcarried=nil
	cargo={}
	for i=1,12 do
		cargo[i]={}
	end
end

loop_width=48*8
half_loop_width=24*8

function get_target_crate()
	local row=flr((px%half_loop_width)/16)+1
	local aside=px<half_loop_width
	local pos
	if aside then
		if cargo[row].b then
			pos="b"
		elseif cargo[row].mid then
			pos=pcarried and "b" or "mid"
		elseif cargo[row].a then
			pos=pcarried and "mid" or "a"
		else
			pos="a"
		end
	else
		if cargo[row].a then
			pos="a"
		elseif cargo[row].mid then
			pos=pcarried and "a" or "mid"
		elseif cargo[row].b then
			pos=pcarried and "mid" or "b"
		else
			pos="b"
		end
	end
	return row,pos
end

function _update()
	if (btn(0)) px-=1
	if (btn(1)) px+=1
	if (px<0) px+=loop_width
	if (px>=loop_width) px-=loop_width
	if btnp(4) then
		local n,pos=get_target_crate()
		if not pcarried and cargo[n][pos] then
			pcarried=cargo[n][pos]
			cargo[n][pos]=nil
		elseif pcarried and not cargo[n][pos] then
			cargo[n][pos]=pcarried
			pcarried=nil
		end
	end
end

function _draw()
	cls()
	map(0,0,-loop_width-px,0,48,16)
	map(0,0,-px,0,48,16)
	map(0,0,loop_width-px,0,48,16)
	
	for i=1,12 do
		local c=cargo[i]
		local x=(i-1)*16-px
		for xoff=-loop_width,loop_width,loop_width do
			if c.a then
				spr(c.a,xoff+x,9*8,2,2)
				spr(c.a,xoff+x+half_loop_width,5*8,2,2,false,true)
			end
			if c.mid then
				spr(c.mid,xoff+x,7*8,2,2)
				spr(c.mid,xoff+x+half_loop_width,7*8,2,2,false,true)
			end
			if c.b then
				spr(c.b,xoff+x,5*8,2,2)
				spr(c.b,xoff+x+half_loop_width,9*8,2,2,false,true)
			end
		end
	end
	local n,pos=get_target_crate()
	local t1={a=9*8,mid=7*8,b=5*8}
	local y1=t1[pos]
	local t2={a=5*8,mid=7*8,b=9*8}
	local y2=t2[pos]
	spr(108,-px+n*16,y1,2,2)
	spr(108,-px+half_loop_width+n*16,y2,2,2)
	
	spr(64,60,104)
end
__gfx__
00000000000000005555555566666666000000000000000000000000000000000000000000000000000000000000000000000000000000006888888888888886
00000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
00600600000007005555555566666666000000000000000000000000000000000000000000000000000000000000000000000000000000008668886886866868
00066000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000008666866886886868
00066000000000006555556666666666000000000000000000000000000000000000000000000000000000000000000000000000000000008666866886886868
00600600007000005566655566666666000000000000000000000000000000000000000000000000000000000000000000000000000000008666866886868868
00000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000008668886886866868
00000000000000005555555566666666000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
00000000000000006dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd68666666886666668
0000000000000000d66656666666566dd66555666665556dd66656666666566dd66555666665556dd66556666666566dd66556666665556d8666666886666668
0000000000000000d66556666665656dd66656666665665dd66565666665656dd66566666665665dd66665666665656dd66665666665665d8666666886666668
0000000000000000d66656666665656dd66656666665556dd66665666665656dd66656666665556dd66665666665656dd66555666665556d8666666886666668
0000000000000000d66656666665556dd66656666665665dd66656666665556dd66665666665665dd66555666665556dd66665666665665d8666666886666668
0000000000000000d66656666665656dd66556666665665dd66566666665656dd66565666665665dd66665666665656dd66665666665665d8666666886666668
0000000000000000d66555666665656dd66656666665556dd66555666665656dd66656666665556dd66556666665656dd66556666665556d8666666886666668
00000000000000006dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd68666666886666668
00000000000000006dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd66111111111111116
0000000000000000d66656666665556dd66555666665656dd66656666665556dd66555666665656dd66556666665556dd66556666665656d1666666666666661
0000000000000000d66556666665665dd66656666665656dd66565666665665dd66566666665656dd66665666665665dd66665666665656d166d66d66d6ddd61
0000000000000000d66656666665665dd66656666665556dd66665666665665dd66656666665556dd66665666665665dd66555666665556d16d6d6d66d66d661
0000000000000000d66656666665556dd66656666665656dd66656666665556dd66665666665656dd66555666665556dd66665666665656d16d6d6d66d66d661
0000000000000000d66656666665665dd66556666665656dd66566666665665dd66565666665656dd66665666665665dd66665666665656d16d6d6d66d66d661
0000000000000000d66555666665556dd66656666666566dd66555666665556dd66656666666566dd66556666665556dd66556666666566d166d666dd666d661
00000000000000006dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd66dddddddddddddd61666666666666661
00000000000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
00000000000000006555555555555556000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
00000000000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
00000000000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
00000000000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
00000000000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
00000000000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
00000000000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
50500505000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
05055050000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
05166150000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
0d56c5d0000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
05666650000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
01555510000000006511111111111156000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
56d66d65000000006555555555555556000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
05555550000000006666666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008668886886866868
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008666866886868868
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008666866886886868
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008666866886886868
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008668886886866868
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008666666886666668
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006888888888888886
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c01666666116666661
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccc00cccc00cccc1666666116666661
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c01666666116666661
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c01666666116666661
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001666666116666661
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c01666666116666661
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c01666666116666661
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c01666666666666661
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c0166d666dd666d661
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016d6d6d66d66d661
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016d6d6d66d66d661
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c016d6d6d66d66d661
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c0166d66d66d6ddd61
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cccc00cccc00cccc1666666666666661
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000c06111111111111116
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044ffffffffff4400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04f4ffffffff4f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04ff4ffffff4ff400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04fff4ffff4fff400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04ffff4ff4ffff400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04fffff44fffff400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04fffff44fffff400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04ffff4ff4ffff400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04fff4ffff4fff400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04ff4ffffff4ff400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04f4ffffffff4f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044ffffffffff4400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001230000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000045660000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000089ab0000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cdef0000
__map__
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03036e6f030303030303030303030303030303030303030303034e4f03030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03037e7f0303141503030303030318190303030303031c1d03035e5f0303242503030303030328290303030303032c2d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3233323332333233323332333233323332333233323332333233323332333233323332333233323332333233323332330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4243424342434243424342434243424342434243424342434243424342434243424342434243424342434243424342430000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3233323332333233323332333233323332333233323332333233323332333233323332333233323332333233323332330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4243424342434243424342434243424342434243424342434243424342434243424342434243424342434243424342430000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3233323332333233323332333233323332333233323332333233323332333233323332333233323332333233323332330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4243424342434243424342434243424342434243424342434243424342434243424342434243424342434243424342430000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03030e0f0303121303030303030316170303030303031a1b03032e2f0303222303030303030326270303030303032a2b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03031e1f030303030303030303030303030303030303030303033e3f03030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
